<head>
    <head>
        <title>Etudiants</title>
        <%-include('./common/head') %>
        <!-- Your other CSS files -->
        <style>
            /* Card Styles */
            .card-title-custom {
                font-size: 16px;
                font-weight: bold;
                   text-align: center;
                text-transform: uppercase; 
                ;/* Add this line to make the text uppercase */
            }
  
            .card {
               
                border-radius:none;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                transition: all 0.3s ease;
                width: auto; /* Set the desired width */
                height: fit-content; /* Set the desired height */
             /*    max-height: fit-content; */
                background-color:beige;
                margin: 10px;
                
            }
  
            .card:hover {
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                transform: translateY(-5px);
               background-color: rgb(255, 255, 255)
            }
  
            .card-body {
                padding: 10px;
                height: 100%; /* Make the card-body take up the full height of the card */
                display: flex;
                flex-direction: column; /* Stack the content vertically */
            }
  
            .card-body > * {
                margin-bottom: 10px; /* Add some spacing between card elements */
            }
  
            .card-body > *:last-child {
                margin-bottom: 0; /* Remove the bottom margin from the last element */
            }
  
            /* Grid Container */
            #stageGrid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); /* Minimum card width of 300px */
                grid-gap: 10px;
                grid-auto-rows: auto; /* Set the desired height for each row */
            }
         
  
            .mybtn {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                align-self: end;
                font-size: 15px;
                width: fit-content;
                height: auto;
            }
            .time-since-created {
                display: none;
            }
  /* 
            .card:hover .time-since-created {
                display: block;
            } */
        </style>
  
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
        <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
         <script src="node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    </head>
  </head>
  <body>
    <div class="custom-container">
        <%-include('./common/sidebar') %>
  
        <div class="main-content">
            <%-include('./common/navbar') %>
            <div style="text-align: center;">
                <h3 style="margin: 15px; padding: 15px;">Etudiant</h3>
            </div>
  
            <%-include('./partial/flaskMessages') %>
        
  
            <div class="">
                <ul class="nav nav-pills mb-3 d-flex justify-content-center" id="pills-tab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link btn-dark" id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home" aria-selected="true">Home</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link btn-dark" id="pills-stage-tab" data-bs-toggle="pill" data-bs-target="#pills-stage" type="button" role="tab" aria-controls="pills-stage" aria-selected="false">Stage</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link btn-dark" id="pills-stage-postule-tab" data-bs-toggle="pill" data-bs-target="#pills-stage-postule" type="button" role="tab" aria-controls="pills-stage-postule" aria-selected="false">
                            Stage postulé
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link btn-dark" id="pills-resultat-tab" data-bs-toggle="pill" data-bs-target="#pills-resultat" type="button" role="tab" aria-controls="pills-resultat" aria-selected="false">Resultat</button>
                    </li>
                <!--     <li class="nav-item" role="presentation">
                        <button class="nav-link btn-dark" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-profile" type="button" role="tab" aria-controls="pills-profile" aria-selected="false">Profile</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link btn-dark" id="pills-contact-tab" data-bs-toggle="pill" data-bs-target="#pills-contact" type="button" role="tab" aria-controls="pills-contact" aria-selected="false">Contact</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link btn-dark" id="pills-disabled-tab" data-bs-toggle="pill" data-bs-target="#pills-disabled" type="button" role="tab" aria-controls="pills-disabled" aria-selected="false" disabled>
                            Disabled
                        </button>
                    </li> -->
                </ul>
                <hr />
                <div class="tab-content" id="pills-tabContent">
                    <!-- d-flex justify-content-center -->
                    <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab" tabindex="0"></div>
                    <div class="tab-pane fade" id="pills-stage" role="tabpanel" aria-labelledby="pills-stage-tab" tabindex="0">
                        <div class="container">
                                <div class="filter-tab" style="margin: 10px;" >
                                    <form>
                                        <div class="row justify-content-center">
                                            <div class="col-md-2">
                                                <select class="form-select" id="domainFilter">
                                                    <option value="">Tous les domaines</option>
                                                    <!-- Populate options dynamically from the received data -->
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <select class="form-select" id="nomFilter">
                                                    <option value="">Tous les noms</option>
                                                    <!-- Populate options dynamically from the received data -->
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <select class="form-select" id="titreFilter">
                                                    <option value="">Tous les titres</option>
                                                    <!-- Populate options dynamically from the received data -->
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <select class="form-select" id="stateFilter">
                                                    <option value="">Tous les états</option>
                                                    <!-- Populate options dynamically from the received data -->
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <select class="form-select" id="sortFilter">
                                                    <option value="asc">Trier par date (Ascendant)</option>
                                                    <option value="desc">Trier par date (Descendant)</option>
                                                </select>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="search-bar input-group mb-3">
                                    <input type="text" class="form-control" id="searchInput" placeholder="Rechercher...">
                                </div>
                                <div id="stageGrid" class="row"></div>
                                <nav aria-label="Page navigation">
                                    <ul class="pagination justify-content-center" id="stagePagination">
                                        <!-- Pagination links will be added here dynamically -->
                                    </ul>
                                </nav>
                            
                           
                            <div id="stageGrid" class="row">
                        
                               <!-- Stage grid will be dynamically populated here -->
                            
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="pills-stage-postule" role="tabpanel" aria-labelledby="pills-stage-postule-tab" tabindex="0">
                        .stage postulé content..
                    </div>
                    <div class="tab-pane fade" id="pills-resultat" role="tabpanel" aria-labelledby="pills-resultat-tab" tabindex="0">.resultat content..</div>
                   <!--  <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab" tabindex="0">.lol..</div>
                    <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab" tabindex="0">.grgg..</div>
                    <div class="tab-pane fade" id="pills-disabled" role="tabpanel" aria-labelledby="pills-disabled-tab" tabindex="0">..grgrgreg.</div> -->
                </div>
            </div>
            <%-include('./common/footer') %>
        </div>
    
    </div>
  
    <!-- Scripts -->
    <!--   <script src="../public/js/script.js"></script> -->
    <!-- Include Bootstrap JS -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <%-include('./partial/etudiantTemplate/filterStage')  %> 
    <script>
        // Function to set active tab based on stored value
        function setActiveTab() {
            const activeTabId = localStorage.getItem("activeTabId");
            if (activeTabId) {
                const activeTab = document.querySelector(`#${activeTabId}`);
                if (activeTab) {
                    activeTab.classList.add("active");
                    const tabContentId = activeTab.getAttribute("aria-controls");
                    const tabContent = document.querySelector(`#${tabContentId}`);
                    if (tabContent) {
                        tabContent.classList.add("show", "active");
                    }
                }
            }
        }
  
        // Add event listener to each tab to store active tab in local storage
        document.querySelectorAll(".nav-link").forEach((tab) => {
            tab.addEventListener("click", function () {
                const tabId = this.getAttribute("id");
                localStorage.setItem("activeTabId", tabId);
            });
        });
  
        // Call the function to set the active tab on page load
        setActiveTab();
    </script>
  
  
    <script>
        // Define a function to fetch postulant data
        async function fetchPostulantData() {
            try {
                const response = await fetch("/etudiant/stage_postuler");
                if (!response.ok) {
                    throw new Error("Failed to fetch postulant data");
                }
                const data = await response.json();
                return data.postulant;
            } catch (error) {
                console.error("Error fetching postulant data:", error);
                return [];
            }
        }
  
        // Define a function to render postulant data in the tab
        async function renderPostulantTab() {
            const postulantTabPane = document.getElementById("pills-stage-postule");
            const postulantList = await fetchPostulantData();
  
            // Clear existing content
            postulantTabPane.innerHTML = "";
  
            // Render postulant data
            const container = document.createElement("div");
            container.classList.add("container", "mt-4");
            container.innerHTML = `
  <div class="container">
  <h3 class="text-center">Listes des stages  Postulés</h3>
  
  <hr>
  <div class="row">
  ${postulantList
    .map(
        (postulant) => `
  <div class="col-md-4">
  <div class="card mb-4 animate__animated animate__fadeInUp postulant-card">
    <div class="card-body">
      <h5 class="card-title card-title-custom">
        <i class="fas fa-user-graduate"></i> ${postulant.etudiantName}
      </h5>
      <hr class="custom-hr">
      <div class="postulant-info">
        <p class="card-text"><i class="fas fa-envelope"></i> <strong>Email :</strong> ${postulant.etudiantEmail}</p>
        <p class="card-text"><i class="fas fa-university"></i> <strong>Institut :</strong> ${postulant.etudiantInstitue}</p>
        <p class="card-text"><i class="fas fa-bookmark"></i> <strong>Domaine :</strong> ${postulant.stageDomaine}</p>
        <p class="card-text"><i class="fas fa-graduation-cap"></i> <strong>Section :</strong> ${postulant.etudiantSection}</p>
        <p class="card-text"><i class="fas fa-book"></i> <strong>Sujet :</strong> ${postulant.stageSujet}</p>
        <p class="card-text"><i class="fas fa-building"></i> <strong>Entreprise :</strong> ${postulant.entrepriseName}</p>
        <p class="card-text">
          <i class="fas fa-info-circle"></i> <strong>Status :</strong> 
          <span class="status-badge status-${postulant.status.toLowerCase().replace(' ', '-')}">${postulant.status}</span>
        </p>
        <p class="card-text">
          <i class="fas fa-calendar-alt"></i> <strong>Date de postulation :</strong> le ${postulant.postulatedAt}
        </p>
      </div>
      <div class="postulant-actions">
        <a href="${postulant.CVPath}" target="_blank" class="btn btn-outline-primary btn-sm">
          <i class="fas fa-file-pdf"></i> Ouvrir CV
        </a>
        <a href="/etudiant/candidatures?etudiantEmail=${postulant.etudiantEmail}&stageId=${postulant.stageId}" class="btn btn-outline-secondary btn-sm">
          <i class="fas fa-eye"></i> Voir plus de détails
        </a>
      </div>
    </div>
  </div>
</div>

     <style>
        .postulant-card {
  border: none;
  border-radius: 10px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  background-color: white;
}

.postulant-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
}

.card-title-custom {
  font-size: 1.5rem;
  font-weight: bold;
  color: #2c3e50;
  margin-bottom: 1rem;
  text-align: center;
}

.custom-hr {
  border: 0;
  height: 1px;
  background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));
  margin: 1rem 0;
}

.postulant-info p {
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
}

.postulant-info p i {
  width: 20px;
  margin-right: 0.5rem;
  color: #3498db;
}

.status-badge {
  display: inline-block;
  padding: 0.25rem 0.5rem;
  border-radius: 50px;
  font-weight: bold;
  font-size: 0.8rem;
  text-transform: uppercase;
}

.status-a-attente {
  background-color: #ffeaa7;
  color: #d35400;
}

.status-accepté {
  background-color: #55efc4;
  color: #27ae60;
}

.status-refusé {
  background-color: #fab1a0;
  color: #c0392b;
}

.postulant-actions {
  display: flex;
  justify-content: space-between;
  margin-top: 1rem;
}

.btn-sm {
  padding: 0.25rem 0.5rem;
  font-size: 0.875rem;
}

.btn-outline-primary {
  color: #3498db;
  border-color: #3498db;
}

.btn-outline-primary:hover {
  background-color: #3498db;
  color: #ffffff;
}

.btn-outline-secondary {
  color: #7f8c8d;
  border-color: #7f8c8d;
}

.btn-outline-secondary:hover {
  background-color: #7f8c8d;
  color: #ffffff;
}

@media (max-width: 768px) {
  .postulant-actions {
    flex-direction: column;
  }

  .postulant-actions .btn {
    margin-bottom: 0.5rem;
  }
}
    </style>
  `
    )
    .join("")}
  </div>
  </div>
  `;
            postulantTabPane.appendChild(container);
        }
  
        // Call the renderPostulantTab function when the page loads
        document.addEventListener("DOMContentLoaded", () => {
            renderPostulantTab();
        });
    </script>
  </body>
